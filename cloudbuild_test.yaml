steps:
  - name: gcr.io/cloud-builders/gcloud
    entrypoint: '/bin/bash'
    args:
      - '-c'
      - |-
        gcloud artifacts docker images describe \
          us-docker.pkg.dev/drewroen-sandbox/appengine/default.version-12345:latest \
          --show-provenance --format json \
          > unverified-provenance.json
        gcloud artifacts docker images describe \
          us-docker.pkg.dev/drewroen-sandbox/appengine/default.version-12345:latest \
           | grep fully_qualified_digest \
           | cut -c 27- \
           > DOCKER_DIGEST_URL
        
  - name: 'golang:stretch'
    entrypoint: '/bin/bash'
    args:
      - '-c'
      - |-
        ls
        go install github.com/slsa-framework/slsa-verifier/v2/cli/slsa-verifier@v2.0.1
        slsa-verifier version
        slsa-verifier verify-image $(cat DOCKER_DIGEST_URL) \
          --source-uri https://github.com/drewroengoogle/test-script \
          --builder-id=https://cloudbuild.googleapis.com/GoogleHostedWorker@v0.3 \
          --provenance-path unverified-provenance.json
timeout: 1200s
